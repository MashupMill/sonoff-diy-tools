(this["webpackJsonpsonoff-diy-tools"]=this["webpackJsonpsonoff-diy-tools"]||[]).push([[0],{103:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(13),i=n.n(c),o=n(28),s=n(18),u=n(29),l=n(30),d=n(58),f=n(51),p=n(59),h=n(138),m=n(25),v=(n(103),n(21)),b=n(12),E=n.n(b),O=n(15),w=n(14),g=n(16),j=n(19),k=n(20),S=n(17),I=window.ipcRenderer,y=["on","off"],C=[].concat(y,["stay"]);function x(e){return!("string"===typeof e&&e.trim().length>0)}var R=function(){function e(t){var n=t.id,a=t.addresses,r=void 0===a?[]:a,c=t.port,i=void 0===c?8081:c;if(Object(u.a)(this,e),!n)throw new Error("Device id must not be blank");if(!r||r.length<1)throw new Error("Device must have an address");this.id=n,this.addresses=r,this.url="http://".concat(this.addresses[0],":").concat(i)}return Object(l.a)(e,[{key:"doRequest",value:function(e,t){return new Promise((function(n,a){I.once(v.channels.DEVICE_API,(function(e,t){t&&0===t.error?n("string"===typeof t.data?JSON.parse(t.data):t.data):a(t)})),I.send(v.channels.DEVICE_API,{url:e,data:t})}))}},{key:"getInfo",value:function(){var e=Object(O.a)(E.a.mark((function e(){var t,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.url,"/zeroconf/info"),n={deviceid:this.id,data:{}},e.next=4,this.doRequest(t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"switch",value:function(){var e=Object(O.a)(E.a.mark((function e(t){var n,a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(this.url,"/zeroconf/switch"),a={deviceid:this.id,data:{switch:t?"on":"off"}},e.next=4,this.doRequest(n,a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setPowerOnState",value:function(){var e=Object(O.a)(E.a.mark((function e(t){var n,a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(C.indexOf(t)<0)){e.next=2;break}throw new Error('Invalid power on state value "'.concat(t,'". Must be one of ').concat(C.join(", ")));case 2:return n="".concat(this.url,"/zeroconf/startup"),a={deviceid:this.id,data:{startup:t}},e.next=6,this.doRequest(n,a);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSignalStrength",value:function(){var e=Object(O.a)(E.a.mark((function e(){var t,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.url,"/zeroconf/signal_strength"),n={deviceid:this.id,data:{}},e.next=4,this.doRequest(t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setInching",value:function(){var e=Object(O.a)(E.a.mark((function e(t){var n,a,r,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.pulse,a=t.pulseWidth,!(y.indexOf(n)<0)){e.next=3;break}throw new Error('Invalid pulse value "'.concat(n,'". Must be one of ').concat(y.join(", ")));case 3:if(!("number"!==typeof a||a<500||a>36e6||a%500!==0)){e.next=5;break}throw new Error('Invalud pulseWidth value "'.concat(a,'". Must be a number that is a multiple of 500 between 500 and 36000000'));case 5:return r="".concat(this.url,"/zeroconf/pulse"),c={deviceid:this.id,data:{pulse:n,pulseWidth:a}},e.next=9,this.doRequest(r,c);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWifi",value:function(){var e=Object(O.a)(E.a.mark((function e(t){var n,a,r,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ssid,a=t.password,!x(n)){e.next=3;break}throw new Error('Invalud ssid value "'.concat(n,'". Must not be blank'));case 3:if(!x(a)){e.next=5;break}throw new Error('Invalud password value "'.concat(a,'". Must not be blank'));case 5:return r="".concat(this.url,"/zeroconf/wifi"),c={deviceid:this.id,data:{ssid:n,password:a}},e.next=9,this.doRequest(r,c);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setOtaUnlock",value:function(){var e=Object(O.a)(E.a.mark((function e(){var t,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.url,"/zeroconf/ota_unlock"),n={deviceid:this.id,data:{}},e.next=4,this.doRequest(t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),N=n(1);function P(e){var t=e.ssid,n=e.password,c=e.isOpen,i=e.onClose,o=e.onSave,s=Object(a.useRef)();return r.a.createElement(h.e,{icon:"warning-sign",isOpen:c,onClose:i,title:"Please double check!",onOpened:function(){return console.log(s.current)}},r.a.createElement("div",{className:"".concat(N.a.DIALOG_BODY," ").concat(N.a.RUNNING_TEXT)},r.a.createElement(h.b,{intent:k.a.WARNING},"Please double check these settings are correct! Once these are saved, the device will disconnect from the current wifi network and attempt to connect to the network shown here."),r.a.createElement(h.h,null,r.a.createElement("p",null,"SSID: ",r.a.createElement("code",null,t)),r.a.createElement("p",null,"Password: ",r.a.createElement("code",null,n)))),r.a.createElement("div",{className:N.a.DIALOG_FOOTER},r.a.createElement("div",{className:N.a.DIALOG_FOOTER_ACTIONS},r.a.createElement(h.a,{onClick:i},"Cancel"),r.a.createElement(h.a,{elementRef:s,intent:k.a.PRIMARY,onClick:o},"Save Wifi Settings"))))}function _(){var e=Object(g.a)(["\n    margin-bottom: 15px;\n"]);return _=function(){return e},e}function A(){var e=Object(g.a)(["\n    &:not(:last-child) {\n        margin-bottom: 5px;\n    }\n"]);return A=function(){return e},e}var V=Object(S.a)(h.l)(A()),D=S.a.div(_());function W(e){var t=e.initialSsid,n=e.deviceApi,c=Object(a.useState)(!1),i=Object(w.a)(c,2),o=i[0],s=i[1],u=Object(a.useState)(!0),l=Object(w.a)(u,2),d=l[0],f=l[1],p=Object(a.useState)(!1),m=Object(w.a)(p,2),v=m[0],b=m[1],E=Object(a.useState)(t),O=Object(w.a)(E,2),g=O[0],j=O[1],S=Object(a.useState)(""),I=Object(w.a)(S,2),y=I[0],C=I[1];if(!g&&t&&j(t),!g)return null;var x=function(e){return console.log("submit"),e.preventDefault(),b(!0),!1};return o?r.a.createElement("form",{onSubmit:x},r.a.createElement(h.g,{label:"Wifi Network"},r.a.createElement(V,{autoFocus:!0,placeholder:"SSID",value:g,onChange:function(e){return j("".concat(e.target.value||"").trim())}}),r.a.createElement(V,{leftIcon:"lock",type:d?"text":"password",placeholder:"Password",rightElement:r.a.createElement(h.a,{onClick:function(){return f(!d)},minimal:!0},r.a.createElement(h.k,{icon:d?"eye-open":"eye-off"})),value:y,onChange:function(e){return C("".concat(e.target.value||"").trim())}})),r.a.createElement(D,{className:N.a.DIALOG_FOOTER_ACTIONS},r.a.createElement(h.a,{small:!0,onClick:function(){s(!1),j(t),C("")}},"Cancel"),r.a.createElement(h.a,{small:!0,disabled:!y,intent:k.a.PRIMARY,type:"submit",onClick:x},"Save")),r.a.createElement(P,{ssid:g,password:y,isOpen:v,onClose:function(){return b(!1)},onSave:function(){n.setWifi({ssid:g,password:y}),s(!1),b(!1)}})):r.a.createElement(h.g,{label:"Wifi Network"},g," ",r.a.createElement(h.a,{minimal:!0,onClick:function(){return s(!0)}},r.a.createElement(h.k,{icon:"edit"})))}function q(){var e=Object(g.a)(["\n    margin-top: 1em;\n\n    ."," > ."," {\n        font-weight: bold;\n    }\n\n    ."," {\n        margin-left: 0;\n        margin-right: 0;\n    }\n"]);return q=function(){return e},e}var z=Object(S.a)(h.b)(q(),N.a.FORM_GROUP,N.a.LABEL,N.a.DIVIDER);function G(e){var t=e.settings,n=void 0===t?{}:t,c=e.onChange,i=e.deviceApi,o=Object(a.useState)(n.pulseWidth),u=Object(w.a)(o,2),l=u[0],d=u[1];return r.a.createElement(z,null,r.a.createElement(h.i,null,"Device Configuration"),r.a.createElement(h.f,null),r.a.createElement(W,{initialSsid:n.ssid,deviceApi:i}),r.a.createElement(h.g,{label:"Power On State"},r.a.createElement(h.j,{value:n.startup,onChange:function(e){return c(Object(s.a)({},n,{startup:e.target.value}))}},r.a.createElement("option",{value:"off"},"Off"),r.a.createElement("option",{value:"on"},"On"),r.a.createElement("option",{value:"stay"},"Stay"))),r.a.createElement(h.g,{label:"Pulse / Inching Settings"},r.a.createElement(h.m,null,r.a.createElement(h.q,{label:"Enabled",checked:"on"===n.pulse,onChange:function(e){return c(Object(s.a)({},n,{pulse:e.target.checked?"on":"off"}))}})),r.a.createElement(h.m,null,"Pulse Width (milliseconds)",r.a.createElement(h.p,{value:l,leftIcon:"time",min:500,max:36e6,stepSize:500,minorStepSize:500,majorStepSize:1e4,onValueChange:function(e){d(e),e%500===0&&c(Object(s.a)({},n,{pulseWidth:e}))}}))))}function M(){var e=Object(g.a)(["\n    & > *:not(:first-child) {\n        margin-left: 10px;\n    }\n"]);return M=function(){return e},e}function F(){var e=Object(g.a)(["\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n\n    && > * {\n        margin-bottom: 0;\n    }\n"]);return F=function(){return e},e}function L(){var e=Object(g.a)(["\n    margin: 1em;\n"]);return L=function(){return e},e}var T=Object(S.a)(h.c)(L()),J=S.a.div(F()),Y=Object(S.a)(J)(M());function B(e){var t=e.device,n=Object(a.useState)(!1),c=Object(w.a)(n,2),i=c[0],o=c[1],u=Object(a.useState)({}),l=Object(w.a)(u,2),d=l[0],f=l[1],p=new R({id:t.txt.id,addresses:t.addresses,port:t.port}),m=function(){p.getInfo().then((function(e){return f(e||{})}))};Object(a.useEffect)(m,[t.txt.id,t.addresses,t.port]),console.log("settings",d);var v=function(){var e=Object(O.a)(E.a.mark((function e(){var t,n,a,r,c,i=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=t.startup,a=t.pulse,r=t.pulseWidth,console.log("changing settings",{startup:n,pulse:a,pulseWidth:r}),c=[],n!==d.startup&&c.push(p.setPowerOnState(n)),a===d.pulse&&r===d.pulseWidth||c.push(p.setInching({pulse:a,pulseWidth:r})),f(Object(s.a)({},d,{startup:n,pulse:a,pulseWidth:r})),e.next=8,Promise.all(c);case 8:m();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(T,{elevation:j.a.ZERO},r.a.createElement(J,null,r.a.createElement(Y,null,r.a.createElement(h.h,null,t.name),r.a.createElement(h.q,{disabled:!d.switch,checked:"on"===d.switch,innerLabel:"off",innerLabelChecked:"on",onChange:function(){var e=Object(O.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.switch(t.target.checked);case 2:m();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),r.a.createElement(h.a,{minimal:!0,intent:i?k.a.PRIMARY:void 0,onClick:function(){return o(!i)}},r.a.createElement(h.k,{icon:"cog"}))),r.a.createElement(h.d,{isOpen:i},r.a.createElement(G,{settings:d,onChange:v,deviceApi:p})))}var U=window.ipcRenderer,H=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={appName:"",appVersion:"",nodeVersion:"",chromeVersion:"",electronVersion:"",devices:{}},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;U.once(v.channels.APP_INFO,(function(t,n){var a=n.appName,r=n.appVersion,c=n.nodeVersion,i=n.chromeVersion,o=n.electronVersion;e.setState({appName:a,appVersion:r,nodeVersion:c,chromeVersion:i,electronVersion:o})})),U.send(v.channels.APP_INFO),U.on(v.channels.DEVICE_RESPONSE,(function(t,n){JSON.stringify(n)!==JSON.stringify(e.state.devices[n.fqdn])&&e.setState({devices:Object(s.a)({},e.state.devices,Object(o.a)({},n.fqdn,n))})})),U.send(v.channels.SCAN_DEVICES)}},{key:"render",value:function(){var e=this.state,t=e.appName,n=e.appVersion,a=Object.values(this.state.devices);return r.a.createElement("div",null,r.a.createElement(h.n,null,r.a.createElement(h.n.Group,{align:m.a.LEFT},r.a.createElement(h.n.Heading,null,t," ",r.a.createElement("small",null,"v",n))),r.a.createElement(h.n.Group,{align:m.a.RIGHT})),r.a.createElement("div",null,a&&a.length>0?a.map((function(e){return r.a.createElement(B,{key:"device-result-".concat(e.fqdn),device:e})})):r.a.createElement(h.o,{icon:"offline",title:"No devices found",description:"Could not find any devices on your network. Please ensure they are on and connected to the same wifi as your computer."})))}}]),t}(a.Component);n(132),n(133),n(134);i.a.render(r.a.createElement(H,null),document.getElementById("root"))},21:function(e,t){e.exports={channels:{APP_INFO:"app_info",SCAN_DEVICES:"scan_devices",DEVICE_RESPONSE:"device_response",DEVICE_API:"device_api",DEVICE_API_ERROR:"device_api_error"}}},98:function(e,t,n){e.exports=n(135)}},[[98,1,2]]]);
//# sourceMappingURL=main.82dc673d.chunk.js.map